{% extends 'base.html' %} {% block content %}
{% load static %}
{% load crispy_forms_tags %}

{% if show.status == 0 and user == show.administrator or show.status %}
<div class="container">
    <div class="row g-0 my-5">
        <div class="col-md-7">
            <h1 class="">{{ show.title }}</h1>
            <p class="h4">{{ show.author }}</p>
            <div class="card-text mt-5 pe-5">
                {{ show.description | safe }}
            </div>
            <p class="small faded">Published on {{ show.created_on | date:"dS F, Y" }}</p>
            {% if user.is_authenticated and show.administrator == user %}
            <div class="manage-podcast">
                <button class="btn btn-delete" data-podcast_id="{{ show.id }}" title="Delete podcast">Delete</button>
                <a class="btn btn-primary" href="/dashboard/edit-podcast/{{ show.id }}" title="Edit podcast">Edit</a>
            </div>
            {% endif %}
        </div>
        <div class="col-md-5">
            {% if "placeholder" in show.artwork.url %}
            <img class="scale rounded-xl" src="{% static 'images/default.jpg' %}" alt="placeholder image">
            {% else %}
            <img class="scale rounded-xl" src="{{ show.artwork.url }}" alt="{{ show.title }}">
            {% endif %}
        </div>
    </div>
</div>

<div class="container">
    <!-- Displaying episodes -->
    <div class="row">
        <div class="col-12">
            <hr>
        </div>
        <!-- <div class="{% if user.is_authenticated and user == show.administrator %}col-md-6{% else %}col-md-12{% endif %} mb-4 mt-3"> -->
        <div class="col-md-12 mb-4 mt-3">
            <div class="card">
                <div class="card-body episodes">
                    <h2 class="d-flex justify-content-between card-title my-3 p-2"><span>All Episodes</span> {% if user.is_authenticated and user == show.administrator %}<a class="btn btn-primary" href="add-episode">Add New</a>{% endif %}</h2>
                    <hr>
                    {% for episode in episodes %}
                    <div class="p-2 {% if not episode.status and show.administrator == user %}faded{% elif not episode.status %} d-none{% endif %}">
                        <p><span class="badge rounded-pill bg-light text-dark">Episode <span id="epEpNum{{ episode.id }}">{{ episode.episode_number }}</span></span></p>
                        <h3 id="epTitle{{ episode.id }}">
                            {{ episode.title }}
                        </h3>                        
                        <div id="epDesc{{ episode.id }}">
                            {{ episode.description | safe }}
                        </div>
                        {% if "resonance/audio" in episode.audiofile.url %}       
                        <div class="controls my-4">
                            <h5 class="mb-3">Listen to the episode</h5>
                            <audio controls src="{{ episode.audiofile.url }}" id="epAudiofile{{ episode.id }}" ></audio>    
                        </div>
                        {% endif %}
                        <p class="fw-light small faded">Added <span
                                class="font-weight-normal">{{ episode.created_on }}</span></p>
                        {% if not episode.status and show.administrator == user %}
                        <p class="approval">This episode is in draft</p>
                        {% endif %}
                        {% if user.is_authenticated and show.administrator == user %}
                        <!-- <div class="episode-extras d-none">
                            <div id="epAuthor{{ episode.id }}">{{ show.author }}</div>
                            <div id="epKeywords{{ episode.id }}">{{ episode.keywords }}</div>
                            <div id="epType{{ episode.id }}">{{ episode.type }}</div>
                            <div id="epSeasonNum{{ episode.id }}">{{ episode.season_number }}</div>
                            <div id="epExplicit{{ episode.id }}">{{ episode.explicit_content_warning }}</div>
                            <div id="epAltEpUrl{{ episode.id }}">{{ episode.alt_episode_url }}</div>
                            <div id="epVideoUrl{{ episode.id }}">{{ episode.video_url }}</div>
                            <div id="epStatus{{ episode.id }}">{{ episode.status }}</div>
                        </div> -->
                        <button class="btn btn-delete" data-episode_id="{{ episode.id }}" title="Delete episode">Delete</button>
                        <a class="btn btn-primary" href="edit-episode/{{ episode.id }}" title="Edit episode">Edit</a>
                        {% endif %}
                        {% if forloop.last == False %}
                        <hr>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <!-- Creating New Episodes -->
        {% if user.is_authenticated and user == show.administrator %}
        <!-- <div class="col-md-6 mb-4 mt-3" id="add-episode" name="add-episode">
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title my-3 p-2">Add a new episode</h2>
                    <hr>
                    <form id="episodeForm" method="post" class="p-2">
                        {{ episode_form | crispy }}
                        {% csrf_token %}
                        <button id="submitButton" type="submit" class="btn btn-primary btn-lg">Submit</button>
                    </form>
                </div>
            </div>
        </div> -->
        {% endif %}
    </div>
</div>
<!-- Delete confirmation modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Delete episode?</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this episode?
                    <br>This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <a id="deleteConfirm" href="#" class="btn btn-danger">Delete</a>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="container">
    <div class="row">
        <h1 class="text-center my-5">Show Unavailable</h1>
        <div class="text-center mb-5"><a class="btn btn-primary" href="{% url 'home' %}">View Published Podcasts</a></div>
    </div>
</div>
{% endif %}

{% endblock content %}

{% block extras %}
<script src="{% static 'js/podcast-episodes.js' %}"></script>
{% endblock %}